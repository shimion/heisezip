/* =
    jquery.eventCalendar.js
    version: 0.68
    date: 17-07-2015
    author:
        Jaime Fernandez (@vissit)
    company:
        Paradigma Tecnologico (@paradigmate)
    url:
        http://www.vissit.com/projects/eventCalendar/
*/

;!function(e){e.fn.eventCalendar=function(t){function a(e,t){return"string"==typeof e.date?e.date.toLowerCase()>t.date.toLowerCase()?1:-1:e.date>t.date?1:-1}function n(t){var a=e("<div class='eventCalendar-slider'></div>"),n=e("<div class='eventCalendar-monthWrap'></div>"),r=e("<div class='eventCalendar-currentTitle'><a href='#' class='eventCalendar-monthTitle'></a></div>"),s=e("<a href='#' class='eventCalendar-arrow eventCalendar-prev'><span>"+v.txt_prev+"</span></a><a href='#' class='eventCalendar-arrow eventCalendar-next'><span>"+v.txt_next+"</span></a>");if($eventsCalendarDaysList=e("<ul class='eventCalendar-daysList'></ul>"),date=new Date,p.wrap.find(".eventCalendar-slider").size()?p.wrap.find(".eventCalendar-slider").append(n):(p.wrap.prepend(a),a.append(n)),p.wrap.find(".eventCalendar-monthWrap.eventCalendar-currentMonth").removeClass("eventCalendar-currentMonth").addClass("eventCalendar-oldMonth"),n.addClass("eventCalendar-currentMonth").append(r,$eventsCalendarDaysList),"current"===t)day=date.getDate(),a.append(s);else{date=new Date(p.wrap.attr("data-current-year"),p.wrap.attr("data-current-month"),1,0,0,0),day=0,moveOfMonth=1,"prev"===t&&(moveOfMonth=-1),date.setMonth(date.getMonth()+moveOfMonth);var i=new Date;date.getMonth()===i.getMonth()&&(day=i.getDate())}var l=date.getFullYear(),o=(new Date).getFullYear(),c=date.getMonth();"current"!=t&&d(v.eventsLimit,l,c,!1,t),p.wrap.attr("data-current-month",c).attr("data-current-year",l),r.find(".eventCalendar-monthTitle").html(v.monthNames[c]+" "+l);var h,f=32-new Date(l,c,32).getDate(),u=[];if(v.showDayAsWeeks){if($eventsCalendarDaysList.addClass("eventCalendar-showAsWeek"),v.showDayNameInCalendar)for($eventsCalendarDaysList.addClass("eventCalendar-showDayNames"),h=0,v.startWeekOnMonday&&(h=1);7>h;h++)u.push('<li class="eventCalendar-day-header">'+v.dayNamesShort[h]+"</li>"),6===h&&v.startWeekOnMonday&&u.push('<li class="eventCalendar-day-header">'+v.dayNamesShort[0]+"</li>");dt=new Date(l,c,1);var C=dt.getDay();for(v.startWeekOnMonday&&(C=dt.getDay()-1),0>C&&(C=6),h=C;h>0;h--)u.push('<li class="eventCalendar-day eventCalendar-empty"></li>')}for(dayCount=1;dayCount<=f;dayCount++){var m="";day>0&&dayCount===day&&l===o&&(m="today"),u.push('<li id="dayList_'+dayCount+'" rel="'+dayCount+'" class="eventCalendar-day '+m+'"><a href="#">'+dayCount+"</a></li>")}$eventsCalendarDaysList.append(u.join("")),a.css("height",n.height()+"px")}function r(e){var t,a=e.length,n=e.charAt(a-1);return t=2===a&&"1"===e.charAt(0)?v.txt_NumAbbrevTh:"1"===n?v.txt_NumAbbrevSt:"2"===n?v.txt_NumAbbrevNd:"3"===n?v.txt_NumAbbrevRd:v.txt_NumAbbrevTh,e+t}function d(t,a,n,r,d){t=t||0,a=a||"",r=r||"",n="undefined"!=typeof n?n:"",p.wrap.find(".eventCalendar-loading").fadeIn(),v.jsonData?(v.cacheJson=!0,p.eventsJson=v.jsonData,s(p.eventsJson,t,a,n,r,d)):v.cacheJson&&d?s(p.eventsJson,t,a,n,r,d):e.getJSON(v.eventsjson+"?limit="+t+"&year="+a+"&month="+n+"&day="+r,function(e){p.eventsJson=e,s(p.eventsJson,t,a,n,r,d)}).error(function(){l("error getting json: ")}),r>""&&(p.wrap.find(".eventCalendar-current").removeClass("eventCalendar-current"),p.wrap.find("#dayList_"+r).addClass("eventCalendar-current"))}function s(t,n,d,s,i,l){directionLeftMove="-="+p.directionLeftMove,eventContentHeight="auto",subtitle=p.wrap.find(".eventCalendar-list-wrap .eventCalendar-subtitle"),l?(subtitle.html(""!==i?v.txt_SpecificEvents_prev+v.monthNames[s]+" "+r(i)+" "+v.txt_SpecificEvents_after:v.txt_SpecificEvents_prev+v.monthNames[s]+" "+v.txt_SpecificEvents_after),"eventCalendar-prev"===l?directionLeftMove="+="+p.directionLeftMove:("day"===l||"month"===l)&&(directionLeftMove="+=0",eventContentHeight=0)):(subtitle.html(v.txt_NextEvents),eventContentHeight="auto",directionLeftMove="-=0"),p.wrap.find(".eventCalendar-list").animate({opacity:v.moveOpacity,left:directionLeftMove,height:eventContentHeight},v.moveSpeed,function(){p.wrap.find(".eventCalendar-list").css({left:0,height:"auto"}).hide();var r=[];if(t=e(t).sort(a),t.length){var l="";v.showDescription||(l="eventCalendar-hidden");var o="_self";v.openEventInNewWindow&&(o="_target");var c=0;e.each(t,function(e,t){if("human"==v.jsonDateFormat)var a=t.date.split(" "),h=a[0].split("-"),f=a[1].split(":"),u=h[0],C=parseInt(h[1])-1,m=parseInt(h[2]),w=(parseInt(C)+1,f[0]),y=f[1],g=f[2],h=new Date(u,C,m,w,y,g);else var h=new Date(parseInt(t.date)),u=h.getFullYear(),C=h.getMonth(),m=h.getDate(),w=h.getHours(),y=h.getMinutes();if(parseInt(y)<=9&&(y="0"+parseInt(y)),(0===n||n>c)&&!(s!==!1&&s!=C||""!==i&&i!=m||""!==d&&d!=u))if(s===!1&&h<new Date);else{eventStringDate=moment(h).format(v.dateFormat);var D;if(t.url)var D='<a href="'+t.url+'" target="'+o+'" class="eventCalendar-eventTitle">'+t.title+"</a>";else var D='<span class="eventCalendar-eventTitle">'+t.title+"</span>";r.push('<li id="'+e+'" class="'+t.type+'"><time datetime="'+h+'"><em>'+eventStringDate+"</em><small>"+w+":"+y+"</small></time>"+D+'<p class="eventCalendar-eventDesc '+l+'">'+t.description+"</p></li>"),c++}u==p.wrap.attr("data-current-year")&&C==p.wrap.attr("data-current-month")&&p.wrap.find(".eventCalendar-currentMonth .eventCalendar-daysList #dayList_"+parseInt(m)).addClass("eventCalendar-dayWithEvents")})}r.length||r.push('<li class="eventCalendar-noEvents"><p>'+v.txt_noEvents+"</p></li>"),p.wrap.find(".eventCalendar-loading").hide(),p.wrap.find(".eventCalendar-list").html(r.join("")),p.wrap.find(".eventCalendar-list").animate({opacity:1,height:"toggle"},v.moveSpeed)}),o()}function i(){p.wrap.find(".eventCalendar-arrow").click(function(t){if(t.preventDefault(),e(this).hasClass("eventCalendar-next")){n("next");var a="-="+p.directionLeftMove}else{n("prev");var a="+="+p.directionLeftMove}p.wrap.find(".eventCalendar-monthWrap.eventCalendar-oldMonth").animate({opacity:v.moveOpacity,left:a},v.moveSpeed,function(){p.wrap.find(".eventCalendar-monthWrap.eventCalendar-oldMonth").remove()})})}function l(e){p.wrap.find(".eventCalendar-list-wrap").html("<span class='eventCalendar-loading eventCalendar-error'>"+e+" "+v.eventsjson+"</span>")}function o(){p.directionLeftMove=p.wrap.width(),p.wrap.find(".eventCalendar-monthWrap").width(p.wrap.width()+"px"),p.wrap.find(".eventCalendar-list-wrap").width(p.wrap.width()+"px")}var v=e.extend({},e.fn.eventCalendar.defaults,t),p={wrap:"",directionLeftMove:"300",eventsJson:{}};this.each(function(){p.wrap=e(this),p.wrap.addClass("eventCalendar-wrap").append("<div class='eventCalendar-list-wrap'><p class='eventCalendar-subtitle'></p><span class='eventCalendar-loading'>"+v.txt_loading+"</span><div class='eventCalendar-list-content'><ul class='eventCalendar-list'></ul></div></div>"),v.eventsScrollable&&p.wrap.find(".eventCalendar-list-content").addClass("scrollable"),o(),e(window).resize(function(){o()}),n("current"),d(v.eventsLimit,!1,!1,!1,!1),i(),p.wrap.on("click",".eventCalendar-day a",function(t){t.preventDefault();var a=p.wrap.attr("data-current-year"),n=p.wrap.attr("data-current-month"),r=e(this).parent().attr("rel");d(!1,a,n,r,"day")}),p.wrap.on("click",".eventCalendar-monthTitle",function(e){e.preventDefault();var t=p.wrap.attr("data-current-year"),a=p.wrap.attr("data-current-month");d(v.eventsLimit,t,a,!1,"month")})}),p.wrap.find(".eventCalendar-list").on("click",".eventCalendar-eventTitle",function(t){if(!v.showDescription){t.preventDefault();var a=e(this).parent().find(".eventCalendar-eventDesc");if(!a.find("a").size()){var n=e(this).attr("href"),r=e(this).attr("target");a.append('<a href="'+n+'" target="'+r+'" class="bt">'+v.txt_GoToEventUrl+"</a>")}a.is(":visible")?a.slideUp():(v.onlyOneDescription&&p.wrap.find(".eventCalendar-eventDesc").slideUp(),a.slideDown())}})},e.fn.eventCalendar.defaults={eventsjson:"js/events.json",eventsLimit:4,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],txt_noEvents:"There are no events in this period",txt_SpecificEvents_prev:"",txt_SpecificEvents_after:"events:",txt_next:"next",txt_prev:"prev",txt_NextEvents:"Next events:",txt_GoToEventUrl:"See the event",txt_NumAbbrevTh:"th",txt_NumAbbrevSt:"st",txt_NumAbbrevNd:"nd",txt_NumAbbrevRd:"rd",txt_loading:"loading...",showDayAsWeeks:!0,startWeekOnMonday:!0,showDayNameInCalendar:!0,showDescription:!1,onlyOneDescription:!0,openEventInNewWindow:!1,eventsScrollable:!1,dateFormat:"D/MM/YYYY",jsonDateFormat:"timestamp",moveSpeed:500,moveOpacity:.15,jsonData:"",cacheJson:!0}}(jQuery);